# AI Reviewer v2.0 配置文件示例
# 这是AI Reviewer的完整配置文件示例，包含所有可配置选项

# =============================================================================
# AI服务配置
# =============================================================================
aiService:
  provider: "deepseek"  # 支持: deepseek, openai, gemini, claude, bedrock
  apiKey: "sk-1c780a5ae9c94d63861d90d5d1930481"  # 环境变量或直接配置
  baseUrl: "https://api.deepseek.com/v1/chat/completions"
#  model: "deepseek-chat"
#  baseUrl: "http://localhost:11434/api/chat"
  model: "deepseek-chat"
  maxTokens: 8000
  temperature: 0

  # AWS Bedrock 配置 (当 provider 为 bedrock 时)
  # apiKey 格式: "AWS_ACCESS_KEY_ID:AWS_SECRET_ACCESS_KEY"
  # 或使用 AWS 默认凭证链（不配置 apiKey）
  region: "us-east-1"  # AWS 区域
  # 支持的模型:
  # - anthropic.claude-v2 (Claude)
  # - anthropic.claude-3-sonnet-20240229-v1:0 (Claude 3)
  # - amazon.titan-text-express-v1 (Titan)
  # - meta.llama2-13b-chat-v1 (Llama 2)
  # - cohere.command-text-v14 (Cohere)
  # - ai21.j2-mid-v1 (AI21 Jurassic)

  # 超时配置 (毫秒) - Hackathon专用优化
  connectTimeout: 300000    # 连接超时: 300秒
  readTimeout: 60000       # 读取超时: 60秒 (适合AI响应)
  writeTimeout: 15000      # 写入超时: 15秒
  analyzeTimeout: 300000    # 单个分析超时: 300秒
  batchAnalyzeTimeout: 120000  # 批量分析超时: 120秒

  maxRetries: 2    # 减少重试次数，加快评审速度
  retryDelay: 1000 # 重试延迟: 1秒
  maxConcurrency: 20  # 增加并发数，提升评审效率
  additionalParams:
    stream: false
    presence_penalty: 0.0
    frequency_penalty: 0.0

# =============================================================================
# 缓存配置
# =============================================================================
cache:
  enabled: true
  type: "file"  # 支持: file, redis, memory
  ttlHours: 24  # 缓存过期时间(小时)
  maxSize: 1000  # 最大缓存条目数
  cleanupIntervalMinutes: 60  # 清理间隔(分钟)

  # 文件缓存配置
  fileCache:
    baseDir: "${user.home}/.ai-reviewer-cache"
    indexFile: "cache-index.json"
    compression: true

  # Redis缓存配置 (可选)
  redisCache:
    host: "localhost"
    port: 6379
    password: ""
    database: 0
    keyPrefix: "ai-reviewer:"

# =============================================================================
# 文件扫描配置
# =============================================================================
fileScan:
  # 包含的文件模式
  includePatterns:
    - "*.java"
    - "*.py"
    - "*.js"
    - "*.ts"
    - "*.go"
    - "*.rs"
    - "*.cpp"
    - "*.c"
    - "*.h"
    - "*.scala"
    - "*.kt"
    - "*.php"
    - "*.rb"
    - "*.cs"
    - "*.swift"
    - "*.dart"
    - "*.yaml"
    - "*.yml"
    - "*.json"
    - "*.xml"
    - "*.properties"
    - "*.md"
    - "*.txt"
    - "Dockerfile"
    - "docker-compose.yml"
    - "Makefile"
    - "CMakeLists.txt"
    - "pom.xml"
    - "build.gradle"
    - "build.gradle.kts"
    - "package.json"
    - "requirements.txt"
    - "Pipfile"
    - "pyproject.toml"
    - "setup.py"
    - "go.mod"
    - "go.sum"
    - "Cargo.toml"
    - "Cargo.lock"
    - "composer.json"
    - "Gemfile"
    - "Gemfile.lock"
    - "*.csproj"
    - "*.fsproj"
    - "*.vbproj"
    - "Package.swift"
    - "pubspec.yaml"

  # 排除的文件模式
  excludePatterns:
    - "*.log"
    - "*.tmp"
    - "*.swp"
    - "*.bak"
    - "*.orig"
    - "*.rej"
    - "*.class"
    - "*.jar"
    - "*.war"
    - "*.ear"
    - "*.zip"
    - "*.tar.gz"
    - "*.tar.bz2"
    - "*.rar"
    - "*.7z"
    - "*~"
    - ".DS_Store"
    - "Thumbs.db"
    - "*.pyc"
    - "__pycache__/"
    - "*.pyo"
    - "*.pyd"
    - ".pytest_cache/"
    - ".coverage"
    - "htmlcov/"
    - "*.egg-info/"
    - "dist/"
    - "build/"
    - ".gradle/"
    - ".idea/"
    - ".vscode/"
    - ".vs/"
    - "bin/"
    - "obj/"
    - ".next/"
    - "node_modules/"
    - ".nuxt/"
    - ".vuepress/"
    - ".cache/"
    - ".parcel-cache/"
    - ".serverless/"
    - ".terraform/"
    - "*.tfstate*"

  # 核心文件模式 (优先分析)
  coreFilePatterns:
    - "*main*"
    - "*app*"
    - "*application*"
    - "*startup*"
    - "*config*"
    - "*controller*"
    - "*service*"
    - "*dao*"
    - "*repository*"
    - "*model*"
    - "*entity*"
    - "*domain*"
    - "*util*"
    - "*helper*"
    - "*manager*"
    - "*factory*"
    - "*builder*"
    - "*handler*"
    - "*processor*"
    - "*interceptor*"
    - "*filter*"
    - "*listener*"
    - "*README*"
    - "*CHANGELOG*"
    - "*ARCHITECTURE*"
    - "*DESIGN*"
    - "*API*"
    - "*GUIDE*"
    - "*pom.xml"
    - "*build.gradle"
    - "*package.json"
    - "*requirements.txt"
    - "*go.mod"
    - "*Cargo.toml"

  # 文件大小和数量限制
  maxFileSize: 1024  # KB
  maxFilesCount: 200
  minFileSize: 1     # KB

  # 扫描选项
  includeTests: false
  includeDependencies: false
  includeGenerated: false
  includeDocumentation: true
  followSymlinks: false

# =============================================================================
# 分析配置
# =============================================================================
analysis:
  # 分析维度
  analysisDimensions:
    - "architecture"
    - "code_quality"
    - "technical_debt"
    - "functionality"
    - "business_value"
    - "test_coverage"

  # 维度权重配置 (权重之和必须为1.0)
  dimensionWeights:
    architecture: 0.20    # 架构设计权重
    code_quality: 0.20    # 代码质量权重
    technical_debt: 0.15  # 技术债务权重
    functionality: 0.20   # 功能完整性权重
    business_value: 0.15  # 商业价值权重
    test_coverage: 0.10   # 测试覆盖率权重

  # 批处理配置
  batchSize: 10  # 批处理大小
  maxConcurrentBatches: 3  # 最大并发批次数
  batchTimeout: 300000  # 批处理超时(毫秒)

  # 上下文配置
  maxContextLength: 32000  # 最大上下文长度
  contextOverlap: 1000     # 上下文重叠长度

  # 分析选项
  enableIncrementalAnalysis: true
  enableParallelAnalysis: true
  enableCaching: true
  enableMetrics: true

  # 领域知识配置
  domainKnowledge:
    java:
      frameworks: ["Spring Boot", "Spring MVC", "Spring Cloud", "Hibernate", "MyBatis", "JPA", "Quarkus", "Micronaut"]
      patterns: ["MVC", "DAO", "Service", "Controller", "Repository", "Factory", "Builder", "Observer", "Strategy", "Decorator"]
      bestPractices: ["SOLID原则", "依赖注入", "异常处理", "日志记录", "单元测试"]
      antiPatterns: ["上帝类", "圈复杂度过高", "硬编码", "魔法数字", "过长方法"]

    python:
      frameworks: ["Django", "Flask", "FastAPI", "SQLAlchemy", "Pydantic", "Celery", "Tornado"]
      patterns: ["MVC", "ORM", "Blueprint", "Factory", "Singleton", "Decorator", "Context Manager"]
      bestPractices: ["PEP 8", "类型提示", "异常处理", "日志记录", "虚拟环境"]
      antiPatterns: ["全局变量", "过长函数", "硬编码路径", "裸异常捕获"]

    javascript:
      frameworks: ["React", "Vue.js", "Angular", "Express.js", "Node.js", "Next.js", "Nuxt.js", "NestJS"]
      patterns: ["MVC", "MVVM", "Component", "Service", "Hook", "Middleware", "Router"]
      bestPractices: ["ES6+", "TypeScript", "模块化", "异步处理", "错误处理"]
      antiPatterns: ["全局变量", "回调地狱", "硬编码", "内存泄漏"]

    go:
      frameworks: ["Gin", "Echo", "Fiber", "Gorilla", "GORM"]
      patterns: ["Interface", "Struct", "Goroutine", "Channel", "Context"]
      bestPractices: ["错误处理", "并发安全", "接口设计", "测试覆盖"]
      antiPatterns: ["panic使用", "全局变量", "过大函数"]

    rust:
      frameworks: ["Actix", "Rocket", "Tokio", "Diesel", "Serde"]
      patterns: ["Trait", "Struct", "Enum", "Ownership", "Borrowing"]
      bestPractices: ["所有权系统", "生命周期", "泛型", "宏使用"]
      antiPatterns: ["unsafe代码", "unwrap调用", "过长函数"]

# =============================================================================
# 评分规则配置
# =============================================================================
scoring:
  # 评分规则列表
  rules:
    # 架构设计评分规则
    - name: "architecture-rule"
      description: "基于关键词匹配的架构评分规则"
      type: "ARCHITECTURE"
      weight: 0.20
      strategy: "keyword_matching"
      enabled: true
      config:
        keywords:
          positive:
            "分层": 10
            "模块化": 10
            "低耦合": 15
            "高内聚": 15
            "设计模式": 10
            "SOLID": 15
            "依赖注入": 10
            "接口隔离": 10
            "单一职责": 10
            "开闭原则": 10
            "里氏替换": 10
            "依赖倒置": 10
            "微服务": 20
            "事件驱动": 15
            "CQRS": 15
            "领域驱动": 20
            "六边形架构": 15
            "清洁架构": 15
          negative:
            "紧耦合": -15
            "循环依赖": -20
            "上帝类": -25
            "硬编码": -10
            "全局变量": -15
            "魔法数字": -10
            "圈复杂度过高": -15
            "过长方法": -10
            "代码重复": -15

    # 代码质量评分规则
    - name: "code-quality-rule"
      description: "基于关键词匹配的代码质量评分规则"
      type: "CODE_QUALITY"
      weight: 0.20
      strategy: "keyword_matching"
      enabled: true
      config:
        keywords:
          positive:
            "单元测试": 15
            "集成测试": 15
            "测试覆盖": 20
            "注释": 10
            "文档": 10
            "命名规范": 10
            "异常处理": 10
            "日志记录": 10
            "类型安全": 15
            "代码审查": 10
            "静态分析": 10
            "代码格式化": 5
            "代码规范": 10
            "最佳实践": 15
            "性能优化": 10
            "内存管理": 10
            "资源清理": 10
          negative:
            "代码重复": -15
            "魔法数字": -10
            "硬编码": -10
            "过长方法": -10
            "过大类": -10
            "圈复杂度": -15
            "未处理异常": -15
            "空指针风险": -15
            "内存泄漏": -20
            "性能问题": -15
            "安全漏洞": -25
            "代码异味": -10

    # 技术债务评分规则
    - name: "technical-debt-rule"
      description: "基于关键词匹配的技术债务评分规则"
      type: "TECHNICAL_DEBT"
      weight: 0.15
      strategy: "keyword_matching"
      enabled: true
      config:
        keywords:
          positive:
            "最新版本": 10
            "现代化": 10
            "重构": 15
            "代码清理": 10
            "技术升级": 15
            "债务偿还": 20
            "架构优化": 15
            "性能提升": 10
            "可维护性": 15
            "可扩展性": 10
          negative:
            "过时": -20
            "废弃": -15
            "遗留代码": -10
            "技术债务": -25
            "维护困难": -15
            "扩展性差": -15
            "性能瓶颈": -15
            "安全风险": -20
            "兼容性问题": -10
            "依赖冲突": -15
            "版本冲突": -10

    # 功能完整性评分规则
    - name: "functionality-rule"
      description: "基于关键词匹配的功能完整性评分规则"
      type: "FUNCTIONALITY"
      weight: 0.20
      strategy: "keyword_matching"
      enabled: true
      config:
        keywords:
          positive:
            "完整": 20
            "边界处理": 15
            "错误处理": 15
            "异常处理": 15
            "输入验证": 15
            "数据校验": 15
            "业务逻辑": 20
            "功能实现": 20
            "API完整": 15
            "接口实现": 15
            "配置管理": 10
            "日志记录": 10
            "监控指标": 10
            "健康检查": 10
            "缓存机制": 10
            "重试机制": 10
            "熔断机制": 10
          negative:
            "缺失": -20
            "不完整": -15
            "未实现": -25
            "功能缺失": -20
            "边界未处理": -15
            "错误未处理": -15
            "输入未验证": -15
            "数据未校验": -15
            "API不完整": -15
            "接口缺失": -15
            "配置缺失": -10
            "日志缺失": -10
            "监控缺失": -10

    # 商业价值评分规则
    - name: "business-value-rule"
      description: "基于关键词匹配的商业价值评分规则"
      type: "BUSINESS_VALUE"
      weight: 0.15
      strategy: "keyword_matching"
      enabled: true
      config:
        keywords:
          positive:
            "成本节约": 20
            "收入增加": 20
            "用户增长": 15
            "效率提升": 15
            "自动化": 15
            "智能化": 15
            "用户体验": 15
            "客户满意": 15
            "市场竞争": 15
            "业务增长": 20
            "运营效率": 15
            "决策支持": 15
            "风险控制": 15
            "合规性": 10
            "可扩展性": 10
            "可维护性": 10
            "技术先进": 15
            "创新性": 15
          negative:
            "成本增加": -15
            "效率低下": -15
            "用户流失": -20
            "市场份额减少": -20
            "技术落后": -15
            "维护困难": -10
            "扩展受限": -10
            "合规风险": -15
            "安全风险": -20

    # 测试覆盖率评分规则
    - name: "test-coverage-rule"
      description: "基于关键词匹配的测试覆盖率评分规则"
      type: "TEST_COVERAGE"
      weight: 0.10
      strategy: "keyword_matching"
      enabled: true
      config:
        keywords:
          positive:
            "高覆盖率": 25
            "单元测试": 15
            "集成测试": 15
            "端到端测试": 15
            "测试自动化": 20
            "测试框架": 10
            "测试用例": 15
            "测试数据": 10
            "测试环境": 10
            "CI/CD": 15
            "持续集成": 15
            "持续部署": 15
            "测试报告": 10
            "测试指标": 10
            "质量门禁": 15
            "回归测试": 10
            "性能测试": 10
            "压力测试": 10
            "安全测试": 10
          negative:
            "低覆盖率": -20
            "无测试": -25
            "测试缺失": -20
            "手动测试": -10
            "测试不充分": -15
            "测试过时": -10
            "测试失败": -15
            "CI失败": -15
            "质量问题": -15
            "bug遗漏": -20
            "回归问题": -15

# =============================================================================
# 报告配置
# =============================================================================
report:
  # 默认报告格式
  defaultFormat: "markdown"  # 支持: markdown, html, json, pdf

  # 报告模板配置
  templates:
    markdown:
      enabled: true
      templateFile: "templates/report-markdown.vm"
      variables:
        projectName: "${project.name}"
        analysisTime: "${analysis.timestamp}"
        overallScore: "${analysis.overallScore}"
        summaryContent: "${analysis.summary}"
        keyFindings: "${analysis.findings}"
        recommendations: "${analysis.recommendations}"

    html:
      enabled: true
      templateFile: "templates/report-html.vm"
      cssFile: "templates/report.css"
      variables:
        projectName: "${project.name}"
        analysisTime: "${analysis.timestamp}"
        overallScore: "${analysis.overallScore}"
        summaryContent: "${analysis.summary}"
        keyFindings: "${analysis.findings}"
        recommendations: "${analysis.recommendations}"

  # 报告选项
  includeCharts: true
  includeMetrics: true
  includeRecommendations: true
  includeCodeExamples: false
  maxRecommendations: 10

# =============================================================================
# 日志配置
# =============================================================================
logging:
  level: "INFO"  # TRACE, DEBUG, INFO, WARN, ERROR
  file:
    enabled: true
    path: "logs/ai-reviewer.log"
    maxSize: "10MB"
    maxFiles: 5
    pattern: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

  console:
    enabled: true
    pattern: "%d{HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# =============================================================================
# 监控配置
# =============================================================================
metrics:
  enabled: true
  export:
    prometheus:
      enabled: true
      port: 9090
      path: "/metrics"
    jmx:
      enabled: true

  # 自定义指标
  custom:
    analysis:
      duration: true
      successRate: true
      cacheHitRate: true
    ai:
      requestCount: true
      errorRate: true
      responseTime: true
    system:
      memoryUsage: true
      cpuUsage: true
      diskUsage: true

# =============================================================================
# 高级配置
# =============================================================================
advanced:
  # 性能调优
  performance:
    threadPoolSize: 10
    queueSize: 100
    timeout: 300000

  # 安全配置
  security:
    enableEncryption: true
    encryptionAlgorithm: "AES256"
    apiKeyRotation: true
    auditLogging: true

  # 实验性功能
  experimental:
    enableMlScoring: false
    enableAdvancedAnalytics: false
    enableCustomRules: false

  # 调试选项
  debug:
    enableVerboseLogging: false
    enableRequestTracing: false
    enablePerformanceProfiling: false
