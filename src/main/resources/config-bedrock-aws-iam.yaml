# AI Reviewer - AWS Bedrock with IAM Role Configuration
# 适用于在 AWS EC2/ECS/Lambda 等服务上运行，使用 IAM 角色默认凭证
# 无需提供 AWS Access Key 和 Secret Key

# =============================================================================
# AI服务配置 - AWS Bedrock (使用默认凭证链)
# =============================================================================
aiService:
  provider: "bedrock"

  # 不设置 apiKey，将自动使用 AWS 默认凭证链
  # AWS SDK 会按以下顺序查找凭证:
  # 1. 环境变量 (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY)
  # 2. Java 系统属性
  # 3. 默认凭证文件 (~/.aws/credentials)
  # 4. Amazon ECS 容器凭证
  # 5. EC2 实例配置文件凭证 (IAM 角色)

  # 使用完整的 ARN 格式或简短格式都可以
  # 完整 ARN 格式示例:
  model: "arn:aws:bedrock:us-east-1:590184013141:inference-profile/us.anthropic.claude-sonnet-4-5-20250929-v1:0"

  # 或者使用简短格式:
  # model: "anthropic.claude-v2"
  # model: "anthropic.claude-3-sonnet-20240229-v1:0"
  # model: "anthropic.claude-3-5-sonnet-20240620-v1:0"

  # AWS 区域（与 model ARN 中的区域保持一致）
  region: "us-east-1"

  # 模型参数
  maxTokens: 8000
  temperature: 0

  # 超时配置 (毫秒)
  connectTimeout: 300000     # 连接超时: 300秒
  readTimeout: 60000         # 读取超时: 60秒
  writeTimeout: 15000        # 写入超时: 15秒
  analyzeTimeout: 300000     # 单个分析超时: 300秒
  batchAnalyzeTimeout: 120000 # 批量分析超时: 120秒

  # 重试和并发配置
  maxRetries: 2              # 最大重试次数
  retryDelay: 1000           # 重试延迟 (毫秒)
  maxConcurrency: 3          # 最大并发请求数

  additionalParams:
    stream: false
    presence_penalty: 0.0
    frequency_penalty: 0.0

# =============================================================================
# 缓存配置
# =============================================================================
cache:
  enabled: true
  type: "file"
  ttlHours: 24
  maxSize: 1000
  cleanupIntervalMinutes: 60

  fileCache:
    baseDir: "${user.home}/.ai-reviewer-cache"
    indexFile: "cache-index.json"
    compression: true

# =============================================================================
# 文件扫描配置
# =============================================================================
fileScan:
  includePatterns:
    - "*.java"
    - "*.py"
    - "*.js"
    - "*.ts"
    - "*.go"
    - "*.rs"
    - "*.cpp"
    - "*.c"
    - "*.h"
    - "*.scala"
    - "*.kt"
    - "*.php"
    - "*.rb"
    - "*.cs"
    - "*.swift"
    - "*.dart"
    - "*.yaml"
    - "*.yml"
    - "*.json"
    - "*.xml"
    - "*.properties"
    - "*.md"
    - "*.txt"
    - "Dockerfile"
    - "docker-compose.yml"
    - "Makefile"
    - "CMakeLists.txt"
    - "pom.xml"

  excludePatterns:
    - "**/target/**"
    - "**/build/**"
    - "**/dist/**"
    - "**/node_modules/**"
    - "**/.git/**"
    - "**/.idea/**"
    - "**/.vscode/**"
    - "**/logs/**"
    - "**/*.log"
    - "**/*.class"
    - "**/*.jar"
    - "**/*.war"

  maxFileSizeKB: 500
  maxTotalFiles: 1000

# =============================================================================
# 评分配置
# =============================================================================
scoring:
  bugWeight: 10.0
  securityWeight: 15.0
  performanceWeight: 8.0
  maintainabilityWeight: 6.0
  styleWeight: 3.0
  documentationWeight: 5.0
  testingWeight: 8.0
  bestPracticesWeight: 7.0
  errorHandlingWeight: 6.0

  severityMultipliers:
    CRITICAL: 3.0
    HIGH: 2.0
    MEDIUM: 1.0
    LOW: 0.5
    INFO: 0.2

# =============================================================================
# 输出配置
# =============================================================================
output:
  format: "json"  # 支持: json, html, markdown
  outputDir: "./review-reports"
  timestamp: true
  includeSourceCode: true
  detailedReport: true
  summaryReport: true

# =============================================================================
# 日志配置
# =============================================================================
logging:
  level: "INFO"  # 支持: DEBUG, INFO, WARN, ERROR
  file: "./logs/ai-reviewer.log"
  maxFileSize: "10MB"
  maxBackupIndex: 5
  console: true

# =============================================================================
# 使用说明
# =============================================================================
# 1. 确保您的 AWS EC2/ECS/Lambda 实例已附加 IAM 角色
# 2. IAM 角色需要有调用 Bedrock 的权限，例如:
#    {
#      "Version": "2012-10-17",
#      "Statement": [
#        {
#          "Effect": "Allow",
#          "Action": [
#            "bedrock:InvokeModel",
#            "bedrock:InvokeModelWithResponseStream"
#          ],
#          "Resource": "arn:aws:bedrock:*:*:*"
#        }
#      ]
#    }
# 3. 运行程序时指定此配置文件:
#    java -jar ai-reviewer.jar --config config-bedrock-aws-iam.yaml

