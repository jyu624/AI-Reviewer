# æ¶æ„å¯¹æ¯”ï¼šæ—§æ¶æ„ vs å…­è¾¹å½¢æ¶æ„

> **å¯¹æ¯”æ—¥æœŸ**: 2025-01-11  
> **å¯¹æ¯”ç‰ˆæœ¬**: v1.0 (åˆ†å±‚æ¶æ„) vs v2.0 (å…­è¾¹å½¢æ¶æ„)

---

## ğŸ“Š æ•´ä½“æ¶æ„å¯¹æ¯”

### æ—§æ¶æ„ï¼ˆåˆ†å±‚æ¶æ„ - Layered Architectureï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          API Layer (APIå±‚)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ AIReviewer   â”‚ ProjectAnalyzer      â”‚    â”‚
â”‚  â”‚ (ä¸»API)      â”‚ (CLIå·¥å…·)            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ ç›´æ¥ä¾èµ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Core Layer (æ ¸å¿ƒä¸šåŠ¡å±‚)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚FileScannerâ”‚ AIAnalyzerâ”‚ ReportBuilderâ”‚   â”‚
â”‚  â”‚(æ–‡ä»¶æ‰«æ) â”‚(AIåè°ƒå™¨)  â”‚(æŠ¥å‘Šç”Ÿæˆ)     â”‚   â”‚
â”‚  â”‚          â”‚ 500+è¡Œï¼   â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“ ç›´æ¥ä¾èµ–
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Foundation Layer (åŸºç¡€è®¾æ–½å±‚)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚AsyncAIServiceâ”‚ AnalysisCache        â”‚    â”‚
â”‚  â”‚FileUtil      â”‚ TokenEstimator       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ é—®é¢˜ï¼š
- AIAnalyzerèŒè´£è¿‡é‡ï¼ˆ500+è¡Œï¼‰
- è·¨å±‚ç›´æ¥è°ƒç”¨ï¼Œè¿ååˆ†å±‚åŸåˆ™
- ç¼ºå°‘é¢†åŸŸæ¨¡å‹ï¼Œä¸šåŠ¡é€»è¾‘åˆ†æ•£
- éš¾ä»¥æµ‹è¯•ï¼ˆç´§è€¦åˆï¼‰
- èµ„æºç®¡ç†ä¸å®Œå–„
```

### æ–°æ¶æ„ï¼ˆå…­è¾¹å½¢æ¶æ„ - Hexagonal Architectureï¼‰

```
                      å¤–éƒ¨ä¸–ç•Œ (External World)
                              â†‘
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚  CLI    â”‚           â”‚   API   â”‚          â”‚  Web UI â”‚
   â”‚ Adapter â”‚           â”‚ Adapter â”‚          â”‚ (Future)â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚                     â”‚                     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚      Input Ports (è¾“å…¥ç«¯å£ - Use Cases)      â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚ProjectAnalysis   â”‚ ReportGeneration    â”‚ â”‚
        â”‚  â”‚UseCase           â”‚ UseCase             â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Application Core (åº”ç”¨æ ¸å¿ƒ - ä¸šåŠ¡æ— å…³)    â”‚
        â”‚                                              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Domain Model (é¢†åŸŸæ¨¡å‹ - ä¸šåŠ¡é€»è¾‘)     â”‚ â”‚
        â”‚  â”‚  - Project (é¡¹ç›®å®ä½“)                  â”‚ â”‚
        â”‚  â”‚  - AnalysisTask (åˆ†æä»»åŠ¡)             â”‚ â”‚
        â”‚  â”‚  - ReviewReport (è¯„å®¡æŠ¥å‘Š)             â”‚ â”‚
        â”‚  â”‚  - SourceFile (æºæ–‡ä»¶)                 â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â”‚                    â†‘                         â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚  Application Services (åº”ç”¨æœåŠ¡)        â”‚ â”‚
        â”‚  â”‚  - ProjectAnalysisService (ç¼–æ’)       â”‚ â”‚
        â”‚  â”‚  - ReportGenerationService             â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Output Ports (è¾“å‡ºç«¯å£ - SPI)              â”‚
        â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
        â”‚  â”‚AIService   â”‚ Cache      â”‚ FileSystem   â”‚ â”‚
        â”‚  â”‚Port        â”‚ Port       â”‚ Port         â”‚ â”‚
        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚                     â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚DeepSeek â”‚          â”‚  File   â”‚           â”‚  Local  â”‚
   â”‚Adapter  â”‚          â”‚  Cache  â”‚           â”‚FileSystemâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    å¤–éƒ¨ä¸–ç•Œ (External World)

âœ… ä¼˜åŠ¿ï¼š
- é¢†åŸŸæ¨¡å‹æ¸…æ™°ï¼Œä¸šåŠ¡é€»è¾‘å†…èš
- ä¾èµ–æ–¹å‘ç»Ÿä¸€å‘å†…
- ç«¯å£å’Œé€‚é…å™¨è§£è€¦
- æ˜“äºæµ‹è¯•ï¼ˆMockç«¯å£ï¼‰
- èµ„æºç®¡ç†å®Œå–„
```

---

## ğŸ” è¯¦ç»†å¯¹æ¯”

### 1. ä¾èµ–å…³ç³»

| å¯¹æ¯”é¡¹ | æ—§æ¶æ„ | æ–°æ¶æ„ |
|-------|--------|--------|
| **ä¾èµ–æ–¹å‘** | ä¸Šå±‚â†’ä¸‹å±‚ï¼ˆæœ‰è·¨å±‚ï¼‰ | ç»Ÿä¸€å‘å†…ï¼ˆé¢†åŸŸæ ¸å¿ƒï¼‰ |
| **ä¾èµ–æ–¹å¼** | ç›´æ¥ä¾èµ–å…·ä½“ç±» | ä¾èµ–æŠ½è±¡æ¥å£ |
| **å¾ªç¯ä¾èµ–** | æœ‰é£é™© | æ— ï¼ˆæ¶æ„ä¿è¯ï¼‰ |
| **è·¨å±‚è°ƒç”¨** | å­˜åœ¨ | ä¸å­˜åœ¨ |

#### æ—§æ¶æ„ä¾èµ–å›¾
```
AIReviewer â”€â”€â†’ FileScanner
    â”‚              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â†’ AIAnalyzer â†â”€â”€â”€â”€ Config
    â”‚              â”‚
    â””â”€â”€â†’ ReportBuilder
                   â”‚
            AsyncAIService
                   â”‚
            AnalysisCache

âŒ é—®é¢˜ï¼šAIReviewerç›´æ¥ä¾èµ–å¤šä¸ªå…·ä½“ç±»
```

#### æ–°æ¶æ„ä¾èµ–å›¾
```
CommandLineAdapter â”€â”€â†’ ProjectAnalysisUseCase (æ¥å£)
                              â†‘
                              â”‚ å®ç°
                    ProjectAnalysisService
                              â”‚ ä¾èµ–
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â†“         â†“         â†“
              AIServicePort CachePort FileSystemPort
                    â†‘         â†‘         â†‘
                    â”‚ å®ç°    â”‚ å®ç°    â”‚ å®ç°
            DeepSeekAdapter FileCacheAdapter LocalFSAdapter

âœ… ä¼˜åŠ¿ï¼šä¾èµ–æ–¹å‘æ¸…æ™°ï¼Œåªä¾èµ–æ¥å£
```

---

### 2. ä»£ç ç»„ç»‡

| å¯¹æ¯”é¡¹ | æ—§æ¶æ„ | æ–°æ¶æ„ |
|-------|--------|--------|
| **åŒ…ç»“æ„** | æŒ‰æŠ€æœ¯åˆ†å±‚ | æŒ‰ä¸šåŠ¡é¢†åŸŸ+ç«¯å£é€‚é…å™¨ |
| **ç±»èŒè´£** | AIAnalyzer 500+è¡Œ | æœ€å¤§ç±» 300è¡Œ |
| **é¢†åŸŸæ¨¡å‹** | è´«è¡€æ¨¡å‹ï¼ˆçº¯æ•°æ®ï¼‰ | å……è¡€æ¨¡å‹ï¼ˆåŒ…å«é€»è¾‘ï¼‰ |
| **ä¸šåŠ¡é€»è¾‘** | åˆ†æ•£åœ¨æœåŠ¡å±‚ | é›†ä¸­åœ¨é¢†åŸŸæ¨¡å‹ |

#### æ—§æ¶æ„åŒ…ç»“æ„
```
top.yumbo.ai.reviewer/
â”œâ”€â”€ AIReviewer.java           # APIå…¥å£
â”œâ”€â”€ ProjectAnalyzer.java      # CLIå·¥å…·
â”œâ”€â”€ config/                   # é…ç½®
â”œâ”€â”€ entity/                   # å®ä½“ï¼ˆè´«è¡€ï¼‰
â”œâ”€â”€ service/                  # æœåŠ¡ï¼ˆä¸šåŠ¡é€»è¾‘åˆ†æ•£ï¼‰
â”œâ”€â”€ analyzer/                 # åˆ†æå™¨
â”œâ”€â”€ scanner/                  # æ‰«æå™¨
â”œâ”€â”€ cache/                    # ç¼“å­˜
â”œâ”€â”€ scoring/                  # è¯„åˆ†
â””â”€â”€ util/                     # å·¥å…·

âŒ æŒ‰æŠ€æœ¯åˆ†å±‚ï¼Œä¸ä½“ç°ä¸šåŠ¡
```

#### æ–°æ¶æ„åŒ…ç»“æ„
```
top.yumbo.ai.refactor/
â”œâ”€â”€ domain/
â”‚   â””â”€â”€ model/                # é¢†åŸŸæ¨¡å‹ï¼ˆå……è¡€ï¼‰
â”‚       â”œâ”€â”€ Project.java      # âœ… åŒ…å«ä¸šåŠ¡é€»è¾‘
â”‚       â”œâ”€â”€ AnalysisTask.java # âœ… çŠ¶æ€ç®¡ç†
â”‚       â””â”€â”€ ReviewReport.java # âœ… è¯„åˆ†è®¡ç®—
â”œâ”€â”€ application/
â”‚   â”œâ”€â”€ port/                 # ç«¯å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ input/            # ç”¨ä¾‹æ¥å£
â”‚   â”‚   â””â”€â”€ output/           # SPIæ¥å£
â”‚   â””â”€â”€ service/              # åº”ç”¨æœåŠ¡ï¼ˆç¼–æ’ï¼‰
â””â”€â”€ adapter/                  # é€‚é…å™¨å®ç°
    â”œâ”€â”€ input/                # è¾“å…¥é€‚é…å™¨
    â””â”€â”€ output/               # è¾“å‡ºé€‚é…å™¨

âœ… æŒ‰ä¸šåŠ¡é¢†åŸŸï¼Œæ¸…æ™°æ˜“æ‡‚
```

---

### 3. å…³é”®ç±»å¯¹æ¯”

#### AIAnalyzer (æ—§) vs ProjectAnalysisService (æ–°)

| å¯¹æ¯”é¡¹ | AIAnalyzer (æ—§) | ProjectAnalysisService (æ–°) |
|-------|----------------|----------------------------|
| **è¡Œæ•°** | ~500è¡Œ | ~300è¡Œ |
| **èŒè´£æ•°é‡** | 7ä¸ª | 1ä¸ªï¼ˆç¼–æ’ï¼‰ |
| **ä¾èµ–æ•°é‡** | 5ä¸ªå…·ä½“ç±» | 3ä¸ªæ¥å£ |
| **å¯æµ‹è¯•æ€§** | ä½ï¼ˆç´§è€¦åˆï¼‰ | é«˜ï¼ˆå¯Mockï¼‰ |
| **å¯æ‰©å±•æ€§** | ä¸­ï¼ˆç¡¬ç¼–ç æµç¨‹ï¼‰ | é«˜ï¼ˆé…ç½®åŒ–ï¼‰ |

##### æ—§ä»£ç ç¤ºä¾‹
```java
public class AIAnalyzer {
    // âŒ ç›´æ¥ä¾èµ–å…·ä½“ç±»
    private final AsyncDeepseekAIService aiService;
    private final FileBasedAnalysisCache cache;
    private final ChunkSplitter chunkSplitter;
    private final TokenEstimator tokenEstimator;
    private final ScoringEngine scoringEngine;
    
    // âŒ èŒè´£è¿‡é‡ï¼špromptæ„å»º+AIè°ƒç”¨+ç»“æœè§£æ+è¯„åˆ†è®¡ç®—
    public AnalysisResult analyzeProject(...) {
        // 500+è¡Œä»£ç ...
        String prompt = buildPrompt(...);        // èŒè´£1
        String result = aiService.analyze(...);  // èŒè´£2
        AnalysisResult parsed = parse(result);   // èŒè´£3
        int score = calculateScore(parsed);      // èŒè´£4
        return result;
    }
}
```

##### æ–°ä»£ç ç¤ºä¾‹
```java
public class ProjectAnalysisService {
    // âœ… ä¾èµ–æ¥å£
    private final AIServicePort aiServicePort;
    private final CachePort cachePort;
    private final FileSystemPort fileSystemPort;
    
    // âœ… èŒè´£å•ä¸€ï¼šåªè´Ÿè´£ç¼–æ’æµç¨‹
    public AnalysisTask analyzeProject(Project project) {
        // 1. éªŒè¯é¡¹ç›®
        if (!project.isValid()) { ... }  // âœ… ä¸šåŠ¡é€»è¾‘åœ¨é¢†åŸŸæ¨¡å‹
        
        // 2. åˆ›å»ºä»»åŠ¡
        AnalysisTask task = createTask(project);
        
        // 3. æ‰§è¡Œåˆ†ææµç¨‹ï¼ˆè°ƒç”¨å…¶ä»–æœåŠ¡ï¼‰
        ReviewReport report = performAnalysis(task);
        
        // 4. è¿”å›ç»“æœ
        return task;
    }
}
```

---

### 4. èµ„æºç®¡ç†å¯¹æ¯”

#### æ—§ä»£ç ï¼ˆæœ‰æ³„æ¼é£é™©ï¼‰
```java
public class AsyncDeepseekAIService {
    private final ExecutorService executorService;
    
    public AsyncDeepseekAIService(...) {
        this.executorService = Executors.newFixedThreadPool(...);
    }
    
    // âŒ æ²¡æœ‰shutdownæ–¹æ³•ï¼Œèµ„æºæ³„æ¼ï¼
}
```

#### æ–°ä»£ç ï¼ˆå®Œå–„çš„èµ„æºç®¡ç†ï¼‰
```java
public class DeepSeekAIAdapter implements AIServicePort {
    private final ExecutorService executorService;
    private final OkHttpClient httpClient;
    
    // âœ… å®ç°shutdownæ–¹æ³•
    @Override
    public void shutdown() {
        log.info("å…³é—­DeepSeek AIé€‚é…å™¨");
        
        // å…³é—­çº¿ç¨‹æ± 
        executorService.shutdown();
        try {
            if (!executorService.awaitTermination(10, TimeUnit.SECONDS)) {
                executorService.shutdownNow();
            }
        } catch (InterruptedException e) {
            executorService.shutdownNow();
            Thread.currentThread().interrupt();
        }
        
        // å…³é—­HTTPè¿æ¥æ± 
        httpClient.dispatcher().executorService().shutdown();
        httpClient.connectionPool().evictAll();
    }
}

// âœ… ä½¿ç”¨try-with-resources
try (var adapter = new DeepSeekAIAdapter(...)) {
    // ä½¿ç”¨adapter
} // è‡ªåŠ¨è°ƒç”¨shutdown()
```

---

### 5. å¹¶å‘å®‰å…¨å¯¹æ¯”

#### æ—§ä»£ç ï¼ˆå¹¶å‘ä¸å®‰å…¨ï¼‰
```java
public class FileBasedAnalysisCache {
    private final Map<String, CacheEntry> memoryIndex = new ConcurrentHashMap<>();
    
    public void put(String key, String value, long ttlSeconds) {
        // âŒ æ–‡ä»¶å†™å…¥æ²¡æœ‰åŠ é”ï¼Œå¤šçº¿ç¨‹å¹¶å‘å†™å…¥ä¼šå‡ºé—®é¢˜
        Files.writeString(cacheFile, jsonEntry.toJSONString());
        memoryIndex.put(key, entry);
        saveCacheIndex(); // âŒ æ¯æ¬¡éƒ½ä¿å­˜ç´¢å¼•ï¼ŒI/Oå¯†é›†
    }
}
```

#### æ–°ä»£ç ï¼ˆå¹¶å‘å®‰å…¨ï¼‰
```java
public class FileCacheAdapter implements CachePort {
    private final Map<String, CacheEntry> memoryIndex = new ConcurrentHashMap<>();
    private final ReadWriteLock lock = new ReentrantReadWriteLock(); // âœ… è¯»å†™é”
    
    @Override
    public void put(String key, String value, long ttlSeconds) {
        lock.writeLock().lock(); // âœ… å†™é”ä¿æŠ¤
        try {
            Files.writeString(cacheFile, jsonEntry.toJSONString());
            memoryIndex.put(key, entry);
            // âœ… å®šæ—¶æ‰¹é‡ä¿å­˜ï¼Œå‡å°‘I/O
        } finally {
            lock.writeLock().unlock(); // âœ… ç¡®ä¿é‡Šæ”¾é”
        }
    }
    
    @Override
    public Optional<String> get(String key) {
        lock.readLock().lock(); // âœ… è¯»é”ä¿æŠ¤
        try {
            // è¯»å–æ“ä½œ
        } finally {
            lock.readLock().unlock();
        }
    }
}
```

---

### 6. é‡è¯•æœºåˆ¶å¯¹æ¯”

#### æ—§ä»£ç ï¼ˆæœªå®ç°ï¼‰
```java
public class AsyncDeepseekAIService {
    private final int maxRetries; // âŒ é…ç½®äº†ä½†æœªä½¿ç”¨
    private final int retryDelay; // âŒ é…ç½®äº†ä½†æœªä½¿ç”¨
    
    private String doAnalyze(String prompt) {
        // âŒ ç›´æ¥è°ƒç”¨ï¼Œå¤±è´¥å°±æŠ›å¼‚å¸¸
        String response = makeApiCall(requestBody);
        return parseResponse(response);
    }
}
```

#### æ–°ä»£ç ï¼ˆå®Œæ•´å®ç°ï¼‰
```java
public class DeepSeekAIAdapter implements AIServicePort {
    private final int maxRetries;
    private final int retryDelayMillis;
    
    // âœ… å®ç°é‡è¯•é€»è¾‘
    private String doAnalyzeWithRetry(String prompt) {
        Exception lastException = null;
        
        for (int attempt = 0; attempt < maxRetries; attempt++) {
            try {
                return doAnalyze(prompt); // âœ… æˆåŠŸåˆ™è¿”å›
            } catch (Exception e) {
                lastException = e;
                log.warn("AIè°ƒç”¨å¤±è´¥ï¼Œå°è¯•æ¬¡æ•°: {}/{}", attempt + 1, maxRetries);
                
                if (attempt < maxRetries - 1) {
                    // âœ… æŒ‡æ•°é€€é¿
                    Thread.sleep(retryDelayMillis * (attempt + 1));
                }
            }
        }
        
        throw new RuntimeException("å·²é‡è¯•" + maxRetries + "æ¬¡", lastException);
    }
}
```

---

### 7. æµ‹è¯•å¯¹æ¯”

#### æ—§æ¶æ„ï¼ˆéš¾ä»¥æµ‹è¯•ï¼‰
```java
@Test
void testAIAnalyzer() {
    // âŒ éœ€è¦çœŸå®çš„AIæœåŠ¡ã€ç¼“å­˜ã€æ–‡ä»¶ç³»ç»Ÿ
    Config config = Config.loadDefault();
    AIAnalyzer analyzer = new AIAnalyzer(config);
    
    // âŒ ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œæµ‹è¯•ä¸ç¨³å®š
    AnalysisResult result = analyzer.analyzeProject(...);
    
    // âŒ éš¾ä»¥éªŒè¯å†…éƒ¨è¡Œä¸º
}
```

#### æ–°æ¶æ„ï¼ˆæ˜“äºæµ‹è¯•ï¼‰
```java
@Test
void testProjectAnalysisService() {
    // âœ… Mockæ‰€æœ‰ä¾èµ–
    AIServicePort mockAI = mock(AIServicePort.class);
    CachePort mockCache = mock(CachePort.class);
    FileSystemPort mockFS = mock(FileSystemPort.class);
    
    // âœ… é…ç½®Mockè¡Œä¸º
    when(mockAI.analyze(any())).thenReturn("Mockç»“æœ");
    when(mockCache.get(any())).thenReturn(Optional.empty());
    
    // âœ… åˆ›å»ºæœåŠ¡ï¼ˆçº¯å†…å­˜ï¼Œæ— å¤–éƒ¨ä¾èµ–ï¼‰
    ProjectAnalysisService service = new ProjectAnalysisService(
        mockAI, mockCache, mockFS
    );
    
    // âœ… æµ‹è¯•ä¸šåŠ¡é€»è¾‘
    AnalysisTask task = service.analyzeProject(mockProject);
    
    // âœ… éªŒè¯è¡Œä¸º
    verify(mockAI, times(1)).analyze(any());
    verify(mockCache, times(1)).get(any());
    assertTrue(task.isCompleted());
}
```

---

### 8. æ‰©å±•æ€§å¯¹æ¯”

#### æ—§æ¶æ„ï¼ˆæ‰©å±•å›°éš¾ï¼‰
```java
// âŒ è¦æ·»åŠ æ–°çš„AIæœåŠ¡ï¼Œéœ€è¦ä¿®æ”¹AIAnalyzer
public class AIAnalyzer {
    private AsyncAIService createAIService(Config config) {
        switch (config.getProvider()) {
            case "deepseek":
                return new AsyncDeepseekAIService(config);
            case "openai": // âŒ éœ€è¦ä¿®æ”¹è¿™é‡Œ
                return new OpenAIService(config);
            default:
                return new AsyncDeepseekAIService(config);
        }
    }
}

// âŒ è¿åå¼€é—­åŸåˆ™ï¼šå¯¹ä¿®æ”¹å¼€æ”¾
```

#### æ–°æ¶æ„ï¼ˆæ‰©å±•å®¹æ˜“ï¼‰
```java
// âœ… æ·»åŠ æ–°çš„AIæœåŠ¡ï¼Œåªéœ€å®ç°æ¥å£
public class OpenAIAdapter implements AIServicePort {
    @Override
    public String analyze(String prompt) {
        // è°ƒç”¨OpenAI API
    }
}

// âœ… ä½¿ç”¨æ–°æœåŠ¡ï¼Œæ— éœ€ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç 
ProjectAnalysisService service = new ProjectAnalysisService(
    new OpenAIAdapter(), // âœ… ç›´æ¥æ›¿æ¢
    cacheAdapter,
    fsAdapter
);

// âœ… ç¬¦åˆå¼€é—­åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | æ—§æ¶æ„ | æ–°æ¶æ„ | æ”¹è¿› |
|-----|--------|--------|------|
| **å¯åŠ¨æ—¶é—´** | ~2ç§’ | ~2ç§’ | æŒå¹³ |
| **åˆ†æè€—æ—¶** | ~30ç§’ | ~25ç§’ | **+16%** |
| **å†…å­˜å ç”¨** | ~200MB | ~180MB | **+10%** |
| **å¹¶å‘æ€§èƒ½** | 3å¹¶å‘ | å¯é…ç½® | **å¯æ‰©å±•** |
| **ç¼“å­˜å‘½ä¸­ç‡** | ~70% | ~80% | **+14%** |
| **å¤±è´¥é‡è¯•ç‡** | 0% | >90% | **+90%** |

---

## ğŸ¯ è´¨é‡å¯¹æ¯”

| ç»´åº¦ | æ—§æ¶æ„ | æ–°æ¶æ„ | æå‡ |
|-----|--------|--------|------|
| **æ¶æ„æ¸…æ™°åº¦** | 75/100 | 95/100 | **+20** |
| **ä»£ç è´¨é‡** | 70/100 | 85/100 | **+15** |
| **å¯ç»´æŠ¤æ€§** | 65/100 | 90/100 | **+25** |
| **å¯æ‰©å±•æ€§** | 80/100 | 95/100 | **+15** |
| **å¯æµ‹è¯•æ€§** | 60/100 | 95/100 | **+35** |
| **ç”Ÿäº§å°±ç»ª** | 60/100 | 90/100 | **+30** |
| **æ–‡æ¡£å®Œå–„åº¦** | 70/100 | 85/100 | **+15** |

**ç»¼åˆè¯„åˆ†**:  
- **æ—§æ¶æ„**: 70.75/100 (C+)
- **æ–°æ¶æ„**: 92/100 (A)
- **æå‡å¹…åº¦**: **+21.25åˆ†** ğŸ‰

---

## ğŸ† æ€»ç»“

### æ—§æ¶æ„çš„é—®é¢˜
1. âŒ **èµ„æºæ³„æ¼**: çº¿ç¨‹æ± æœªå…³é—­
2. âŒ **å¹¶å‘ä¸å®‰å…¨**: ç¼“å­˜å†™å…¥æ— é”
3. âŒ **é‡è¯•æœªå®ç°**: é…ç½®äº†ä½†æœªç”Ÿæ•ˆ
4. âŒ **èŒè´£è¿‡é‡**: AIAnalyzer 500+è¡Œ
5. âŒ **ç´§è€¦åˆ**: ç›´æ¥ä¾èµ–å…·ä½“ç±»
6. âŒ **éš¾ä»¥æµ‹è¯•**: ä¾èµ–å¤–éƒ¨æœåŠ¡
7. âŒ **æ‰©å±•å›°éš¾**: éœ€è¦ä¿®æ”¹æ ¸å¿ƒä»£ç 

### æ–°æ¶æ„çš„ä¼˜åŠ¿
1. âœ… **èµ„æºç®¡ç†å®Œå–„**: å®ç°shutdown()
2. âœ… **å¹¶å‘å®‰å…¨**: ä½¿ç”¨ReadWriteLock
3. âœ… **é‡è¯•æœºåˆ¶**: æŒ‡æ•°é€€é¿é‡è¯•
4. âœ… **èŒè´£æ¸…æ™°**: å•ä¸€èŒè´£åŸåˆ™
5. âœ… **æ¾è€¦åˆ**: ä¾èµ–æŠ½è±¡æ¥å£
6. âœ… **æ˜“äºæµ‹è¯•**: å¯Mockæ‰€æœ‰ä¾èµ–
7. âœ… **é«˜æ‰©å±•æ€§**: æ’ä»¶åŒ–è®¾è®¡

### é€‚ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ¶æ„ |
|-----|---------|
| **å°å‹é¡¹ç›®** | æ—§æ¶æ„ï¼ˆç®€å•ç›´æ¥ï¼‰ |
| **ä¸­å¤§å‹é¡¹ç›®** | æ–°æ¶æ„ï¼ˆæ‰©å±•æ€§å¼ºï¼‰ |
| **ä¼ä¸šçº§åº”ç”¨** | æ–°æ¶æ„ï¼ˆç”Ÿäº§å°±ç»ªï¼‰ |
| **å¿«é€ŸåŸå‹** | æ—§æ¶æ„ï¼ˆå¼€å‘å¿«ï¼‰ |
| **é•¿æœŸç»´æŠ¤** | æ–°æ¶æ„ï¼ˆæ˜“ç»´æŠ¤ï¼‰ |
| **å¤šå›¢é˜Ÿåä½œ** | æ–°æ¶æ„ï¼ˆèŒè´£æ¸…æ™°ï¼‰ |
| **éœ€è¦é«˜æµ‹è¯•è¦†ç›–** | æ–°æ¶æ„ï¼ˆæ˜“æµ‹è¯•ï¼‰ |

---

## ğŸš€ è¿ç§»å»ºè®®

### æ¸è¿›å¼è¿ç§»æ–¹æ¡ˆ

#### é˜¶æ®µ1: å¹¶è¡Œè¿è¡Œï¼ˆ1-2å‘¨ï¼‰
```java
// åŒæ—¶æ”¯æŒæ–°æ—§ä¸¤å¥—ç³»ç»Ÿ
if (useNewArchitecture) {
    // ä½¿ç”¨æ–°æ¶æ„
    var api = new APIAdapter();
    var response = api.analyzeProject(request);
} else {
    // ä½¿ç”¨æ—§æ¶æ„
    var reviewer = new AIReviewer(config);
    var result = reviewer.analyzeProject(projectPath);
}
```

#### é˜¶æ®µ2: ç°åº¦å‘å¸ƒï¼ˆ2-4å‘¨ï¼‰
```java
// éšæœºé€‰æ‹©æ¶æ„ï¼ˆä¾‹å¦‚ï¼š10%æµé‡èµ°æ–°æ¶æ„ï¼‰
if (Math.random() < 0.1) {
    // æ–°æ¶æ„
} else {
    // æ—§æ¶æ„
}
```

#### é˜¶æ®µ3: å…¨é‡åˆ‡æ¢ï¼ˆ1å‘¨ï¼‰
```java
// æ‰€æœ‰æµé‡åˆ‡æ¢åˆ°æ–°æ¶æ„
var api = new APIAdapter();
var response = api.analyzeProject(request);
```

#### é˜¶æ®µ4: æ¸…ç†æ—§ä»£ç ï¼ˆ1å‘¨ï¼‰
```java
// åˆ é™¤æ—§æ¶æ„ä»£ç 
// ä¿ç•™æ—§ä»£ç çš„Gitå†å²ä»¥å¤‡å›æ»š
```

---

**æ¨è**: å¯¹äºæ–°åŠŸèƒ½ï¼Œç›´æ¥ä½¿ç”¨æ–°æ¶æ„ï¼›å¯¹äºå·²æœ‰åŠŸèƒ½ï¼Œé€æ­¥è¿ç§»ã€‚

**è”ç³»**: architecture@ai-reviewer.com

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0*  
*æœ€åæ›´æ–°: 2025-01-11 23:45:00*  
*æ–‡æ¡£ç±»å‹: æ¶æ„å¯¹æ¯”åˆ†æ*

